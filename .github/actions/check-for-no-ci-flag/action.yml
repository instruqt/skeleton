name: CI Enabled Check
description: Pulls track tags from Instruqt to determine if "no-ci" tag is set
inputs:
  tracks:
    description: Array of track directories to test
    required: true
outputs:
  ci:
    description: Whether CI is enabled or disabled
runs:
  using: composite
  steps:
  - name: Parse track.yml for no-ci, ci-skip or skip-ci tags
    shell: bash
    run: |
      
      TRACK=${{ inputs.track }}

      SKIP_ENABLED=$(yq '.tags | any_c(test("(?i)no-ci|skip-ci|ci-skip"))' $TRACK/track.yml)

      if [[ SKIP_ENABLED == 'false']]; then 
        echo "CI is disabled for this track."
        exit 1
      else 
        echo "CI is enabled for this track."
      fi